## 目标与范围
- 聚焦 `json-formatter.html`，将“格式化 (Tree)”改为输入实时自动格式化。
- 保持现有“压缩 (Text)”与“清空”功能，增强性能与交互。

## 核心改动：实时自动格式化
- 删除按钮与事件：移除顶部“格式化 (Tree)”按钮（`json-formatter.html:136-139`），不再依赖 `formatJSON` 手动触发。
- 输入监听与防抖：在 `setup` 内对 `input` 做 300–500ms 防抖监听；成功解析后更新 `jsonData`、`output`，将 `viewMode` 置为 `tree`；失败时填充 `error` 并保留当前视图。
- 开关控制：新增“实时格式化”开关（默认开启），允许用户临时关闭自动格式化以便大规模编辑。
- 成功反馈：保留轻量成功提示（`successMessage`）并自动消退。

## 展示与交互改进
- 数组索引展示：在数组项中显示索引作为键名（更新 `JsonViewer` 的子迭代，`json-for1matter.html:120-123`，为数组传递索引字符串到 `key-name`）。
- 层级展开：新增“按层级展开/折叠”按钮（展开到 1/2/N 层），通过新增 `expandLevelSignal` 并在组件中比较深度控制。
- 节点选择与路径复制：点击节点可选中并高亮，在头部显示选中节点 JSONPath（点/括号混合），提供“复制路径”。
- 搜索过滤：添加搜索框，按键名/值子串匹配；仅展开匹配路径，非匹配可淡显或折叠。
- 对象键排序：提供“保持原顺序/按字母排序”开关，仅影响渲染顺序。

## 体验与稳定性
- 大文件防卡策略：
  - 解析与渲染分离；超过阈值（如 > 2–5MB 或节点数过大）自动切换文本视图或提示开启“仅文本模式”。
  - 可选引入 Web Worker 做解析，避免主线程卡顿。
  - 虚拟滚动（按需渲染可见节点）降低 DOM 压力。
- 错误定位：解析 `JSON.parse` 错误信息中的 `position`，映射为行/列，显示清晰提示；可选在左侧 textarea 内高亮错误位置。
- 状态持久化：使用 `localStorage` 存储最近一次输入、视图模式与开关状态，页面刷新后恢复。

## 兼容性与样式
- 暗色主题：支持 `prefers-color-scheme` 自动切换或提供主题按钮，复用已定义 CSS 变量。
- 类型高亮与可访问性：统一色彩与层级边框；提供键盘操作（方向键展开/折叠、Enter 切换、Ctrl+C 复制选中节点）。

## 可选高级功能（按需）
- JSONPath 查询框：输入路径直接定位并高亮节点。
- 导入/导出：支持拖拽文件、从 URL 拉取；导出为 `.json`/压缩字符串；可选导出为 YAML（需引入库）。
- JSON Schema 校验：可选引入 AJV 做 schema 校验与错误列表展示。

## 实施步骤
1. 移除“格式化 (Tree)”按钮与其事件绑定（`json-formatter.html:136-139`），保留其他按钮与状态区域。
2. 在 `setup` 新增 `autoFormat`（默认 `true`）与防抖 `watch`，当 `autoFormat` 为真时监听 `input` 并执行解析更新；错误时填充 `error`，不清空已有树。
3. 将现有 `formatJSON` 的逻辑迁移/复用到自动解析流程，统一成功与错误消息处理（参考 `json-formatter.html:302-318`）。
4. 数组索引作为键名：更新 `json-viewer` 子迭代逻辑，为数组传索引到 `key-name`，对象仍传原键名（`json-formatter.html:120-123`）。
5. 层级展开：新增信号 `expandLevelSignal`，组件内根据自身深度与信号值决定 `expanded` 初始与响应行为；头部添加 1/2/N 层按钮。
6. 路径选择与复制：在组件 `setup` 注入/提供 `selectedPath` 与 `onSelect`，节点点击时更新；头部添加展示与复制按钮，复用现有 `copyOutput` 逻辑。
7. 搜索：新增 `query` 状态与匹配函数，渲染时对不匹配节点折叠/淡显，匹配节点高亮。
8. 本地存储：在 mount 读写 `input`、`viewMode`、`autoFormat` 等，异常情况安全降级。
9. 大文件策略与提示：检测输入大小/节点数，提示并切换文本视图；必要时后续引入 Web Worker 与虚拟滚动。

## 验收标准
- 左侧输入在 300–500ms 内触发右侧树视图更新，错误时给出行列提示且不闪烁。
- 5MB 级 JSON 输入页面仍可交互，展开/折叠与搜索功能可用。
- 数组索引显示、路径复制、层级展开、搜索与对象键排序均按预期工作。
- 关闭“实时格式化”后，不再自动解析；手动压缩与清空仍有效。

## 风险与回退
- 实时解析导致卡顿：通过防抖、阈值、文本模式与（可选）Worker 降低风险。
- 视图自动切换打断操作：提供开关与明显提示，保留用户选择。
- 所有改动限定在该文件内，若用户不满意，可快速回退到按钮触发模式。